
	


<div class="row g-4 productbox">
    {{#each products}}
    <div class="col-6 col-md-4 col-lg-3">
        <div class="card h-100 border-0 shadow-sm">
            <a href="productdetail?id={{this._id}}" class="text-decoration-none">
                <img src="{{this.image.[0]}}" class="card-img-top img-fluid" alt="Product Image">
            </a>
            <div class="card-body d-flex flex-column justify-content-between">
                <div>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <h5 class="card-title text-truncate">{{this.name}}</h5>
                        <a href="#" onclick="addToWishlist('{{../userId}}', '{{this._id}}')" class="text-muted">
                            {{#if this.isWishlisted}}
                            <i class="fa fa-heart" aria-hidden="true"></i>
                            {{else}}
                            <i class="fa fa-heart-o" aria-hidden="true"></i>
                            {{/if}}
                        </a>
                    </div>
                    <p class="card-text text-muted small">{{this.variant}}</p>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <div>
                        <span class="fw-bold">₹{{this.price}}</span>
                        <span class="text-muted text-decoration-line-through small">₹{{this.mrp}}</span>
                    </div>
                </div>
                {{#if this.tags}}
                <div class="mt-2">
                    <span class="badge bg-danger text-light">{{this.tags}}</span>
                </div>
                {{/if}}
            </div>
        </div>
    </div>
    {{/each}}
</div>
<script>
	function addToWishlist(userId, productId) {
			event.preventDefault();
    fetch('/add-to-wishlist', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ userId, productId })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Failed to add/remove product to/from wishlist');
        }
        if (response.redirected) {
            window.location.href = "/login";
        }
        return response.json();
    })
    .then(data => {
        // Toggle the wishlist icon
        const wishlistIcon = document.querySelector(`[onclick="addToWishlist('${userId}', '${productId}')"] i`);
        if (wishlistIcon) {
            wishlistIcon.classList.toggle('fa-heart');
            wishlistIcon.classList.toggle('fa-heart-o');
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

</script>